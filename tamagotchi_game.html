<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тамагочи - Игра</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
        }
        
        .pet-display {
            font-size: 80px;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .pet-name {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .hunger-fill { background: #ff6b6b; }
        .energy-fill { background: #4ecdc4; }
        .mood-fill { background: #45b7d1; }
        .hygiene-fill { background: #96ceb4; }
        
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-emoji {
            font-size: 24px;
        }
        
        .status-message {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            min-height: 20px;
        }
        
        .coins-display {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .level-display {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        
        .sleep-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .sleep-message {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .sleep-emoji {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .sleep-time {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .wake-up-btn {
            background: #4ecdc4;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Анимация вылупления */
        .hatching-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }
        
        .egg-container {
            position: relative;
            cursor: pointer;
            user-select: none;
            margin-bottom: 30px;
        }
        
        .egg {
            font-size: 120px;
            animation: bounce 1s infinite;
            transition: all 0.3s ease;
        }
        
        .egg:hover {
            transform: scale(1.1);
        }
        
        .egg.clicked {
            animation: shake 0.5s infinite;
        }
        
        .hatching-text {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .click-instruction {
            font-size: 16px;
            text-align: center;
            margin: 10px 0;
            opacity: 0.8;
            animation: blink 2s infinite;
        }
        
        .crack {
            position: absolute;
            top: 0;
            left: 0;
            font-size: 120px;
            color: rgba(255, 255, 255, 0.3);
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .crack.show {
            opacity: 1;
            animation: crack-appear 0.5s ease-in-out;
        }
        
        .crack-line {
            position: absolute;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 2px;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .crack-line.show {
            opacity: 1;
            animation: crack-grow 0.5s ease-out;
        }
        
        .crack-line-1 {
            width: 60px;
            height: 3px;
            top: 30px;
            left: 20px;
            transform: rotate(15deg);
        }
        
        .crack-line-2 {
            width: 40px;
            height: 3px;
            top: 50px;
            right: 25px;
            transform: rotate(-20deg);
        }
        
        .crack-line-3 {
            width: 50px;
            height: 3px;
            bottom: 40px;
            left: 30px;
            transform: rotate(45deg);
        }
        
        .crack-line-4 {
            width: 35px;
            height: 3px;
            bottom: 60px;
            right: 20px;
            transform: rotate(-30deg);
        }
        
        .pet-emerging {
            font-size: 120px;
            animation: emerge 1s ease-out;
            margin-bottom: 30px;
        }
        
        .name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 18px;
            text-align: center;
            margin: 20px 0;
            width: 200px;
        }
        
        .name-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .hatch-btn {
            background: #4ecdc4;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes crack-appear {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes crack-grow {
            0% { width: 0; opacity: 0; }
            100% { width: var(--crack-width); opacity: 1; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 0.8; }
            51%, 100% { opacity: 0.4; }
        }
        
        @keyframes emerge {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pet-display.happy {
            animation: pulse 1s infinite;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Оверлей вылупления -->
    <div class="hatching-overlay" id="hatchingOverlay">
        <div class="egg-container" id="eggContainer" onclick="crackEgg()">
            <div class="egg" id="egg">🥚</div>
            <div class="crack hidden" id="crack">💥</div>
            <div class="crack-line crack-line-1" id="crackLine1"></div>
            <div class="crack-line crack-line-2" id="crackLine2"></div>
            <div class="crack-line crack-line-3" id="crackLine3"></div>
            <div class="crack-line crack-line-4" id="crackLine4"></div>
        </div>
        <div class="hatching-text" id="hatchingText">Нажмите на яйцо, чтобы помочь питомцу вылупиться!</div>
        <div class="click-instruction" id="clickInstruction">👆 Нажимайте на яйцо, чтобы создать трещины</div>
        <div class="pet-emerging hidden" id="petEmerging"></div>
        <input type="text" class="name-input hidden" id="nameInput" placeholder="Введите имя питомца" maxlength="20">
        <button class="hatch-btn hidden" id="hatchBtn" onclick="completeHatching()">Вылупить!</button>
    </div>

    <!-- Основная игра -->
    <div class="game-container hidden" id="gameContainer">
        <div class="pet-display" id="petDisplay">🐱</div>
        <div class="pet-name" id="petName">Мой питомец</div>
        
        <div class="level-display">
            <div>⭐ Уровень: <span id="level">1</span></div>
            <div>💫 Опыт: <span id="exp">0</span>/100</div>
            <div>🎂 Возраст: <span id="age">0 дней</span></div>
        </div>
        
        <div class="coins-display">
            💰 Монеты: <span id="coins">100</span>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-label">🍕 Голод</div>
                <div class="stat-value" id="hungerValue">50%</div>
                <div class="progress-bar">
                    <div class="progress-fill hunger-fill" id="hungerBar" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat">
                <div class="stat-label">⚡ Энергия</div>
                <div class="stat-value" id="energyValue">50%</div>
                <div class="progress-bar">
                    <div class="progress-fill energy-fill" id="energyBar" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat">
                <div class="stat-label">😊 Настроение</div>
                <div class="stat-value" id="moodValue">50%</div>
                <div class="progress-bar">
                    <div class="progress-fill mood-fill" id="moodBar" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat">
                <div class="stat-label">🛁 Гигиена</div>
                <div class="stat-value" id="hygieneValue">50%</div>
                <div class="progress-bar">
                    <div class="progress-fill hygiene-fill" id="hygieneBar" style="width: 50%"></div>
                </div>
            </div>
        </div>
        
        <div class="status-message" id="statusMessage">Питомец чувствует себя хорошо!</div>
        
        <div class="actions">
            <button class="action-btn" id="feedBtn" onclick="feedPet()">
                <div class="action-emoji">🍕</div>
                <div>Покормить</div>
            </button>
            <button class="action-btn" id="playBtn" onclick="playWithPet()">
                <div class="action-emoji">🎮</div>
                <div>Играть</div>
            </button>
            <button class="action-btn" id="cleanBtn" onclick="cleanPet()">
                <div class="action-emoji">🛁</div>
                <div>Мыть</div>
            </button>
            <button class="action-btn" id="sleepBtn" onclick="putToSleep()">
                <div class="action-emoji">😴</div>
                <div>Спать</div>
            </button>
        </div>
        
        <div class="actions">
            <button class="action-btn" onclick="showGames()">
                <div class="action-emoji">🎲</div>
                <div>Игры</div>
            </button>
            <button class="action-btn" onclick="showShop()">
                <div class="action-emoji">🛒</div>
                <div>Магазин</div>
            </button>
        </div>
        
        <div class="actions">
            <button class="action-btn" onclick="syncWithBot()">
                <div class="action-emoji">🔄</div>
                <div>Синхронизация</div>
            </button>
            <button class="action-btn" onclick="savePetData()">
                <div class="action-emoji">💾</div>
                <div>Сохранить</div>
            </button>
        </div>
    </div>
    
    <div class="sleep-overlay" id="sleepOverlay">
        <div class="sleep-message">
            <div class="sleep-emoji">😴</div>
            <div class="sleep-time" id="sleepTime">Спит еще: 01:30</div>
            <div>Энергия восстанавливается...</div>
            <button class="wake-up-btn" onclick="wakeUp()">Разбудить</button>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // Telegram WebApp API
        const tg = window.Telegram.WebApp;
        
        // Инициализация
        tg.ready();
        tg.expand();
        
        // Данные питомца
        let petData = {
            name: 'Мой питомец',
            type: 'cat',
            level: 1,
            exp: 0,
            coins: 100,
            hunger: 50,
            energy: 50,
            mood: 50,
            hygiene: 50,
            isSleeping: false,
            sleepUntil: null,
            lastAction: null,
            actionCooldown: 0,
            lifeDays: 0,
            lastFeedDay: null,
            isHatched: false
        };
        
        // Получаем данные пользователя из Telegram
        let telegramUser = null;
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            telegramUser = tg.initDataUnsafe.user;
            console.log('Telegram user:', telegramUser);
        }
        
        // Типы питомцев и их эмодзи
        const petTypes = {
            'cat': '🐱',
            'dog': '🐶',
            'rabbit': '🐰',
            'hamster': '🐹'
        };
        
        // Состояния питомца
        const petStates = {
            'happy': '😊',
            'normal': '😐',
            'sad': '😢',
            'very_sad': '😭',
            'sleeping': '😴'
        };
        
        // Инициализация игры
        function initGame() {
            // Загружаем сохраненные данные
            loadPetData();
            
            // Проверяем, есть ли уже питомец
            if (petData.isHatched) {
                startGame();
            } else {
                startHatching();
            }
            
            // Обработчики кнопок Telegram
            tg.MainButton.setText('Сохранить игру');
            tg.MainButton.onClick(() => {
                savePetData();
                tg.close();
            });
            
            tg.BackButton.onClick(() => {
                savePetData();
                tg.close();
            });
        }
        
        // Переменные для интерактивного вылупления
        let crackCount = 0;
        let maxCracks = 4;
        
        // Начало вылупления
        function startHatching() {
            document.getElementById('hatchingOverlay').classList.remove('hidden');
            document.getElementById('gameContainer').classList.add('hidden');
            
            // Сбрасываем счетчик трещин
            crackCount = 0;
            
            // Показываем инструкцию
            document.getElementById('hatchingText').textContent = 'Нажмите на яйцо, чтобы помочь питомцу вылупиться!';
            document.getElementById('clickInstruction').classList.remove('hidden');
        }
        
        // Обработка клика по яйцу
        function crackEgg() {
            if (crackCount >= maxCracks) return;
            
            crackCount++;
            
            // Добавляем анимацию тряски
            const egg = document.getElementById('egg');
            egg.classList.add('clicked');
            
            setTimeout(() => {
                egg.classList.remove('clicked');
            }, 500);
            
            // Показываем трещину
            const crackLine = document.getElementById(`crackLine${crackCount}`);
            crackLine.classList.add('show');
            
            // Обновляем текст
            if (crackCount === 1) {
                document.getElementById('hatchingText').textContent = 'Первая трещина! Продолжайте!';
            } else if (crackCount === 2) {
                document.getElementById('hatchingText').textContent = 'Трещины растут! Еще немного!';
            } else if (crackCount === 3) {
                document.getElementById('hatchingText').textContent = 'Почти готово! Последний клик!';
            } else if (crackCount === maxCracks) {
                // Показываем финальную трещину
                document.getElementById('crack').classList.remove('hidden');
                document.getElementById('crack').classList.add('show');
                document.getElementById('hatchingText').textContent = 'Яйцо треснуло! Питомец вылупляется!';
                document.getElementById('clickInstruction').classList.add('hidden');
                
                // Запускаем финальную анимацию
                setTimeout(() => {
                    showPetEmerging();
                }, 1500);
            }
        }
        
        // Показ вылупляющегося питомца
        function showPetEmerging() {
            const petType = getRandomPetType();
            const petEmoji = petTypes[petType];
            
            document.getElementById('egg').classList.add('hidden');
            document.getElementById('crack').classList.add('hidden');
            document.getElementById('petEmerging').textContent = petEmoji;
            document.getElementById('petEmerging').classList.remove('hidden');
            document.getElementById('hatchingText').textContent = 'Питомец вылупляется!';
            
            petData.type = petType;
            
            // Показываем поле ввода имени
            setTimeout(() => {
                document.getElementById('nameInput').classList.remove('hidden');
                document.getElementById('hatchBtn').classList.remove('hidden');
                document.getElementById('hatchingText').textContent = 'Дайте имя вашему питомцу!';
            }, 2000);
        }
        
        // Завершение вылупления
        function completeHatching() {
            const name = document.getElementById('nameInput').value.trim();
            if (name) {
                petData.name = name;
            }
            
            petData.isHatched = true;
            petData.lastFeedDay = new Date().toDateString();
            
            // Скрываем оверлей вылупления
            document.getElementById('hatchingOverlay').classList.add('hidden');
            
            // Показываем игру
            startGame();
            
            showNotification(`🎉 Поздравляем! ${petData.name} вылупился!`);
        }
        
        // Начало игры
        function startGame() {
            document.getElementById('hatchingOverlay').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            
            // Обновляем интерфейс
            updateDisplay();
            
            // Запускаем игровой цикл
            startGameLoop();
            
            // Синхронизируемся с ботом
            syncWithBot();
        }
        
        // Получение случайного типа питомца
        function getRandomPetType() {
            const types = Object.keys(petTypes);
            return types[Math.floor(Math.random() * types.length)];
        }
        
        // Загрузка данных питомца
        function loadPetData() {
            const saved = localStorage.getItem('tamagotchi_pet');
            if (saved) {
                const savedData = JSON.parse(saved);
                petData = { ...petData, ...savedData };
            }
        }
        
        // Сохранение данных питомца
        function savePetData() {
            localStorage.setItem('tamagotchi_pet', JSON.stringify(petData));
            
            // Отправляем данные обратно в бот
            if (tg.sendData) {
                const dataToSend = {
                    action: 'update_pet_data',
                    petData: petData,
                    user: telegramUser
                };
                tg.sendData(JSON.stringify(dataToSend));
            }
        }
        
        // Синхронизация с ботом
        async function syncWithBot() {
            if (!telegramUser) return;
            
            try {
                // Запрашиваем данные питомцев у бота
                const requestData = {
                    action: 'get_pet_data',
                    userId: telegramUser.id
                };
                
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(requestData));
                }
                
                // Загружаем сохраненные данные как fallback
                loadPetData();
                updateDisplay();
                
            } catch (error) {
                console.log('Ошибка синхронизации с ботом:', error);
                // Используем локальные данные
                loadPetData();
                updateDisplay();
            }
        }
        
        // Обработка ответа от бота
        function handleBotResponse(data) {
            if (data.action === 'pet_data_response' && data.pets) {
                if (data.pets.length > 0) {
                    // Берем первого питомца
                    const botPet = data.pets[0];
                    petData = { ...petData, ...botPet };
                    updateDisplay();
                    showNotification('Данные синхронизированы с ботом! 🔄');
                }
            }
        }
        
        // Обновление отображения
        function updateDisplay() {
            // Обновляем имя и тип питомца
            document.getElementById('petName').textContent = petData.name;
            document.getElementById('petDisplay').textContent = getPetEmoji();
            
            // Обновляем уровень и опыт
            document.getElementById('level').textContent = petData.level;
            const expNeeded = petData.level * 100;
            const expProgress = petData.exp % 100;
            document.getElementById('exp').textContent = `${expProgress}/${100}`;
            
            // Обновляем возраст
            const ageText = petData.lifeDays === 0 ? 'новорожденный' : `${petData.lifeDays} дней`;
            document.getElementById('age').textContent = ageText;
            
            // Обновляем монеты
            document.getElementById('coins').textContent = petData.coins;
            
            // Обновляем статистики
            updateStat('hunger', petData.hunger);
            updateStat('energy', petData.energy);
            updateStat('mood', petData.mood);
            updateStat('hygiene', petData.hygiene);
            
            // Обновляем статус
            updateStatus();
            
            // Проверяем сон
            if (petData.isSleeping) {
                showSleepOverlay();
            } else {
                hideSleepOverlay();
            }
            
            // Обновляем кнопки
            updateButtons();
        }
        
        // Получение эмодзи питомца
        function getPetEmoji() {
            const baseEmoji = petTypes[petData.type] || '🐱';
            const state = getPetState();
            return state === 'sleeping' ? baseEmoji + '😴' : baseEmoji + petStates[state];
        }
        
        // Определение состояния питомца
        function getPetState() {
            if (petData.isSleeping) return 'sleeping';
            
            const avg = (petData.hunger + petData.energy + petData.mood + petData.hygiene) / 4;
            
            if (avg >= 80) return 'happy';
            if (avg >= 50) return 'normal';
            if (avg >= 20) return 'sad';
            return 'very_sad';
        }
        
        // Обновление статистики
        function updateStat(stat, value) {
            document.getElementById(stat + 'Value').textContent = value + '%';
            document.getElementById(stat + 'Bar').style.width = value + '%';
        }
        
        // Обновление статуса
        function updateStatus() {
            const state = getPetState();
            const messages = {
                'happy': 'Питомец очень счастлив! 🌟',
                'normal': 'Питомец чувствует себя хорошо! ⭐',
                'sad': 'Питомец грустит... 😢',
                'very_sad': 'Питомцу нужна помощь! 😭',
                'sleeping': 'Питомец спит... 😴'
            };
            
            document.getElementById('statusMessage').textContent = messages[state] || 'Питомец чувствует себя хорошо!';
        }
        
        // Обновление кнопок
        function updateButtons() {
            const buttons = ['feedBtn', 'playBtn', 'cleanBtn', 'sleepBtn'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (petData.actionCooldown > 0) {
                    btn.disabled = true;
                    btn.textContent = `⏳ ${petData.actionCooldown}с`;
                } else {
                    btn.disabled = false;
                    btn.innerHTML = getButtonHTML(btnId);
                }
            });
        }
        
        // Получение HTML кнопки
        function getButtonHTML(btnId) {
            const buttons = {
                'feedBtn': '<div class="action-emoji">🍕</div><div>Покормить</div>',
                'playBtn': '<div class="action-emoji">🎮</div><div>Играть</div>',
                'cleanBtn': '<div class="action-emoji">🛁</div><div>Мыть</div>',
                'sleepBtn': '<div class="action-emoji">😴</div><div>Спать</div>'
            };
            return buttons[btnId] || '';
        }
        
        // Показать уведомление
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Показать оверлей сна
        function showSleepOverlay() {
            document.getElementById('sleepOverlay').style.display = 'flex';
            updateSleepTime();
        }
        
        // Скрыть оверлей сна
        function hideSleepOverlay() {
            document.getElementById('sleepOverlay').style.display = 'none';
        }
        
        // Обновление времени сна
        function updateSleepTime() {
            if (!petData.isSleeping || !petData.sleepUntil) return;
            
            const now = new Date();
            const sleepEnd = new Date(petData.sleepUntil);
            const remaining = sleepEnd - now;
            
            if (remaining <= 0) {
                wakeUp();
                return;
            }
            
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            
            document.getElementById('sleepTime').textContent = 
                `Спит еще: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Действия с питомцем
        function feedPet() {
            if (petData.actionCooldown > 0) return;
            
            petData.hunger = Math.min(100, petData.hunger + 20);
            petData.mood = Math.min(100, petData.mood + 5);
            petData.coins = Math.max(0, petData.coins - 5);
            
            // Обновляем возраст при кормлении
            updateAge();
            
            addExp(5);
            startActionCooldown();
            showNotification('Питомец покормлен! 🍕 +5 опыта');
            updateDisplay();
            savePetData();
        }
        
        // Обновление возраста
        function updateAge() {
            const today = new Date().toDateString();
            if (petData.lastFeedDay !== today) {
                petData.lifeDays++;
                petData.lastFeedDay = today;
            }
        }
        
        // Система уровней
        function checkLevelUp() {
            const expNeeded = petData.level * 100;
            if (petData.exp >= expNeeded) {
                petData.level++;
                petData.exp -= expNeeded;
                showNotification(`🎉 Уровень повышен! Новый уровень: ${petData.level}!`);
                return true;
            }
            return false;
        }
        
        // Добавление опыта
        function addExp(amount) {
            petData.exp += amount;
            checkLevelUp();
        }
        
        function playWithPet() {
            if (petData.actionCooldown > 0) return;
            
            petData.mood = Math.min(100, petData.mood + 15);
            petData.energy = Math.max(0, petData.energy - 10);
            petData.hunger = Math.max(0, petData.hunger - 5);
            
            addExp(3);
            startActionCooldown();
            showNotification('Питомец поиграл! 🎮 +3 опыта');
            updateDisplay();
            savePetData();
        }
        
        function cleanPet() {
            if (petData.actionCooldown > 0) return;
            
            petData.hygiene = Math.min(100, petData.hygiene + 25);
            petData.mood = Math.min(100, petData.mood + 10);
            petData.energy = Math.max(0, petData.energy - 5);
            
            addExp(2);
            startActionCooldown();
            showNotification('Питомец помыт! 🛁 +2 опыта');
            updateDisplay();
            savePetData();
        }
        
        function putToSleep() {
            if (petData.actionCooldown > 0) return;
            
            petData.isSleeping = true;
            petData.sleepUntil = new Date(Date.now() + 90 * 60 * 1000); // 90 минут
            
            startActionCooldown();
            showNotification('Питомец уснул! 😴');
            updateDisplay();
        }
        
        function wakeUp() {
            if (!petData.isSleeping) return;
            
            // Восстанавливаем энергию
            const sleepDuration = 90; // минут
            const energyRestore = Math.min(100, petData.energy + 50);
            petData.energy = energyRestore;
            
            petData.isSleeping = false;
            petData.sleepUntil = null;
            
            showNotification('Питомец проснулся! ⚡');
            updateDisplay();
        }
        
        // Запуск кулдауна действия
        function startActionCooldown() {
            petData.actionCooldown = 10; // 10 секунд
        }
        
        // Игровой цикл
        function startGameLoop() {
            setInterval(() => {
                // Уменьшаем кулдаун
                if (petData.actionCooldown > 0) {
                    petData.actionCooldown--;
                }
                
                // Естественное ухудшение параметров
                if (!petData.isSleeping) {
                    petData.hunger = Math.max(0, petData.hunger - 1);
                    petData.energy = Math.max(0, petData.energy - 1);
                    petData.mood = Math.max(0, petData.mood - 1);
                    petData.hygiene = Math.max(0, petData.hygiene - 1);
                }
                
                // Обновляем отображение
                updateDisplay();
                
                // Сохраняем данные каждые 30 секунд
                if (Date.now() % 30000 < 1000) {
                    savePetData();
                }
            }, 1000);
        }
        
        // Мини-игры
        function showGames() {
            const gameText = `
🎲 Мини-игры

Выберите игру:
• Угадай число (5 монет) - выигрыш: 10 монет
• Орёл или решка (3 монеты) - выигрыш: 6 монет  
• Кости (4 монеты) - выигрыш: 8 монет

У вас: ${petData.coins} монет
            `;
            
            // Показываем модальное окно с играми
            showGameModal(gameText);
        }
        
        function showGameModal(text) {
            // Создаем модальное окно для игр
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: rgba(255,255,255,0.1);
                border-radius: 20px;
                padding: 30px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.2);
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            content.innerHTML = `
                <div style="white-space: pre-line; margin-bottom: 20px;">${text}</div>
                <div id="gameButtons"></div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: #ff6b6b; border: none; border-radius: 10px; padding: 10px 20px; color: white; margin-top: 20px; cursor: pointer;">
                    Закрыть
                </button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Добавляем кнопки игр
            const buttonsContainer = content.querySelector('#gameButtons');
            const games = [
                { name: '🎯 Угадай число', cost: 5, reward: 10, func: 'playGuessGame' },
                { name: '🪙 Орёл/Решка', cost: 3, reward: 6, func: 'playCoinGame' },
                { name: '🎲 Кости', cost: 4, reward: 8, func: 'playDiceGame' }
            ];
            
            games.forEach(game => {
                const button = document.createElement('button');
                button.textContent = `${game.name} (${game.cost}💰)`;
                button.style.cssText = `
                    display: block;
                    width: 100%;
                    margin: 10px 0;
                    padding: 15px;
                    background: ${petData.coins >= game.cost ? '#4ecdc4' : '#666'};
                    border: none;
                    border-radius: 10px;
                    color: white;
                    font-size: 16px;
                    cursor: ${petData.coins >= game.cost ? 'pointer' : 'not-allowed'};
                `;
                
                if (petData.coins >= game.cost) {
                    button.onclick = () => {
                        modal.remove();
                        window[game.func]();
                    };
                }
                
                buttonsContainer.appendChild(button);
            });
        }
        
        // Игра "Угадай число"
        function playGuessGame() {
            if (petData.coins < 5) {
                showNotification('Недостаточно монет! 💰');
                return;
            }
            
            const number = Math.floor(Math.random() * 10) + 1;
            const userGuess = prompt('Угадайте число от 1 до 10:');
            
            if (userGuess === null) return;
            
            const guess = parseInt(userGuess);
            if (isNaN(guess) || guess < 1 || guess > 10) {
                showNotification('Введите число от 1 до 10!');
                return;
            }
            
            petData.coins -= 5;
            
            if (guess === number) {
                petData.coins += 10;
                petData.exp += 5;
                showNotification(`🎉 Победа! Число было ${number}. Получено: 10 монет, 5 опыта!`);
            } else {
                showNotification(`😔 Проигрыш! Число было ${number}. Потеряно: 5 монет`);
            }
            
            updateDisplay();
            savePetData();
        }
        
        // Игра "Орёл или решка"
        function playCoinGame() {
            if (petData.coins < 3) {
                showNotification('Недостаточно монет! 💰');
                return;
            }
            
            const result = Math.random() < 0.5 ? 'орёл' : 'решка';
            const userChoice = prompt('Выберите: орёл или решка?');
            
            if (userChoice === null) return;
            
            petData.coins -= 3;
            
            if (userChoice.toLowerCase() === result) {
                petData.coins += 6;
                petData.exp += 3;
                showNotification(`🎉 Победа! Выпал ${result}. Получено: 6 монет, 3 опыта!`);
            } else {
                showNotification(`😔 Проигрыш! Выпал ${result}. Потеряно: 3 монеты`);
            }
            
            updateDisplay();
            savePetData();
        }
        
        // Игра "Кости"
        function playDiceGame() {
            if (petData.coins < 4) {
                showNotification('Недостаточно монет! 💰');
                return;
            }
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const sum = dice1 + dice2;
            
            petData.coins -= 4;
            
            if (sum >= 7) {
                petData.coins += 8;
                petData.exp += 4;
                showNotification(`🎉 Победа! Кости: ${dice1} + ${dice2} = ${sum}. Получено: 8 монет, 4 опыта!`);
            } else {
                showNotification(`😔 Проигрыш! Кости: ${dice1} + ${dice2} = ${sum}. Потеряно: 4 монеты`);
            }
            
            updateDisplay();
            savePetData();
        }
        
        function showShop() {
            showNotification('Магазин скоро будет доступен! 🛒');
        }
        
        // Запуск игры
        initGame();
    </script>
</body>
</html>